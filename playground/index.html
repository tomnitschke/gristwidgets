<html>
<head>
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>

  <script type="module" src="./index.js"></script>

  <style>
    :not(:defined) { visibility: hidden; }
    html, body { margin:0; padding:0; font-size:var(--grist-theme-medium-font-size); font-family:var(--grist-theme-font-family); }
    sl-dialog::part(close-button) { display: none; }
    #configContainer { display:flex; flex-direction:column; row-gap:var(--sl-spacing-small); }
    #content { height:100%;width:100%;border:solid 1px var(--grist-theme-widget-border);box-sizing:border-box; }
    #reloadBtn { position:absolute; z-index:9999; bottom:10px; left:10px; }
    #configOpenBtn { position:absolute; z-index:9999; bottom:10px; right:10px; }

    :not(:defined) { visibility:hidden; }
    html, body { margin:0; padding:0; font-size:var(--grist-theme-medium-font-size); font-family: var(--grist-theme-font-family); }
    sl-dialog::part(header) { display:none; }
    #config::part(panel) { display:flex; flex-direction:column; align-content:flex-start; row-gap:var(--sl-spacing-small); --width:90%; }
    #config h1 { font-size:1.2rem; }
    .configRow { display:flex; justify-content:flex-start; }
    .configGroup { display:flex }
    .configRow, .configGroup { align-items:baseline; column-gap:10px; }
  </style>
</head>
<body>
  <div id="status"></div>
  <sl-button id="reloadBtn" size="small" variant="neutral" outline style="display:none;">
    <sl-icon slot="prefix" name="arrow-clockwise"></sl-icon>
    Reload Playground
  </sl-button>
  <sl-button id="configOpenBtn" size="small" variant="neutral" outline style="display:none;">
    <sl-icon slot="prefix" name="gear"></sl-icon>
    Playground Config
  </sl-button>
  <sl-dialog id="config" label="Config">
    <h1>General Settings</h1>
    <div class="config-row">
      <sl-checkbox class="configItem" id="config_enableButtons" size="small" help-text="Show the 'Reload Playground' and 'Playground Settings' buttons. WARNING: If you hide these, the only way to edit these settings (and get them back) is to manually edit the settings JSON stored on the Grist record.">Enable playground buttons</sl-checkbox>
    </div>
    <div class="config-row">
      <sl-checkbox class="configItem" id="config_enableAutoreload" size="small" help-text="Automatically reload the playground whenever the user-supplied HTML and/or JS changes.">Enable auto-reload</sl-checkbox>
    </div>
    <h1>Settings for Playground Content</h1>
    <div class="config-row">
      <sl-checkbox class="configItem" id="config_importGristThemeCSSVars" size="small">Import Grist theme CSS vars into loaded content</sl-checkbox>
    </div>
    <div class="config-row">
      <sl-textarea class="configItem" id="config_jsPrelude" label="JS Prelude">
        <p slot="help-text">JS code to be inserted into the document head before any user-defined code.</p>
      </sl-textarea>
      <sl-textarea class="configItem" id="config_htmlPrelude" label="HTML Prelude">
        <p slot="help-text">HTML markup to be inserted into the document head before any user-defined markup.</p>
      </sl-textarea>
    </div>
    <div class="config-row">
      <sl-textarea class="configItem" id="config_defaultHtml" label="Default HTML content">
        <p slot="help-text">HTML markup to insert if there is no user-defined markup.</p>
      </sl-textarea>
    </div>
    <sl-button-group slot="footer">
      <sl-button id="configResetBtn" size="small">Reset</sl-button>
      <sl-button size="small" variant="primary" onclick="document.querySelector('#config').hide();">Close</sl-button>
    </sl-button-group>
  </sl-dialog>
  <iframe id="content"></iframe>
</body>
</html>
